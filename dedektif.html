<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Dedektif Selim: GÃ¶lgelerin Ä°Ã§inde</title>
    <style>
        /* --- ATMOSFERÄ°K TASARIM --- */
        :root {
            --bg-color: #0d0d0d;
            --panel-bg: #1a1a1a;
            --accent: #00ff9d;
            --accent-dim: rgba(0, 255, 157, 0.1);
            --danger: #ff4444;
            --text-main: #e0e0e0;
            --text-dim: #888;
        }

        body { 
            background: var(--bg-color); 
            color: var(--text-main); 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            padding: 20px; 
            height: 100vh;
            margin: 0;
            overflow: hidden;
            background-image: radial-gradient(circle at center, #1a1a1a 0%, #000 100%);
        }

        h2 { 
            text-transform: uppercase; 
            letter-spacing: 3px; 
            border-bottom: 2px solid var(--accent); 
            padding-bottom: 10px;
            text-shadow: 0 0 15px var(--accent);
        }

        #main-wrapper { 
            display: flex; 
            gap: 20px; 
            max-width: 1400px; 
            width: 95%; 
            height: 85vh; 
        }

        /* --- OYUN ALANI (SOL) --- */
        #game-container { 
            flex: 2.5; 
            display: flex; 
            flex-direction: column; 
            background: var(--panel-bg); 
            border: 1px solid #333; 
            border-radius: 8px; 
            padding: 20px; 
            box-shadow: 0 0 30px rgba(0,0,0,0.8);
            position: relative;
        }

        /* Ä°statistik BarÄ± */
        #stats-bar {
            display: flex;
            justify-content: space-between;
            background: #111;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            border: 1px solid #333;
        }
        .stat-box { font-weight: bold; font-family: monospace; font-size: 1.1em; }
        .stat-danger { color: var(--danger); animation: pulse 1s infinite; }

        /* Sohbet EkranÄ± */
        #dialogue-box { 
            flex-grow: 1; 
            overflow-y: auto; 
            padding: 15px; 
            margin-bottom: 15px; 
            background: #000; 
            border: 1px solid #333; 
            border-radius: 4px; 
            font-family: 'Consolas', monospace; 
            line-height: 1.5;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.5);
        }

        .msg { margin: 8px 0; padding: 8px 12px; border-radius: 4px; max-width: 85%; animation: fadeIn 0.3s ease; }
        .msg-system { color: #f1c40f; border-left: 3px solid #f1c40f; background: rgba(241, 196, 15, 0.1); width: 100%; }
        .msg-hero { color: #ccc; align-self: flex-end; text-align: right; border-right: 3px solid #3498db; background: rgba(52, 152, 219, 0.1); margin-left: auto; }
        .msg-suspect { color: var(--accent); border-left: 3px solid var(--accent); background: var(--accent-dim); }
        .msg-accuse { color: var(--danger); text-align: center; font-weight: bold; border: 1px solid var(--danger); width: 100%; }

        /* Karakterler */
        .suspect-list { display: flex; gap: 10px; margin-bottom: 15px; overflow-x: auto; padding-bottom: 5px; }
        .suspect { 
            flex: 1; 
            text-align: center; 
            background: #222; 
            padding: 10px; 
            border: 1px solid #444; 
            border-radius: 5px; 
            cursor: pointer; 
            transition: 0.3s; 
            min-width: 100px;
            position: relative;
        }
        .suspect:hover { background: #333; border-color: var(--accent); }
        .suspect.active { background: var(--accent-dim); border-color: var(--accent); box-shadow: 0 0 10px var(--accent-dim); }
        .suspect-stress-bar { height: 4px; background: #333; margin-top: 5px; border-radius: 2px; overflow: hidden; }
        .stress-fill { height: 100%; background: var(--danger); width: 0%; transition: width 0.5s; }

        /* Kontroller */
        .input-area { display: flex; gap: 10px; }
        input { 
            flex-grow: 1; padding: 12px; background: #111; border: 1px solid #444; color: white; 
            font-family: monospace; font-size: 1.1em; outline: none; transition: 0.3s;
        }
        input:focus { border-color: var(--accent); }
        button { 
            padding: 10px 20px; cursor: pointer; border: none; font-weight: bold; text-transform: uppercase; 
            background: #333; color: white; transition: 0.3s; 
        }
        .btn-ask:hover { background: var(--accent); color: black; }
        .btn-action { width: 100%; margin-top: 5px; background: #444; }
        .btn-action:hover { background: #666; }
        .btn-arrest { background: #5a1a1a; color: #ff9999; margin-top: 10px; }
        .btn-arrest:hover { background: var(--danger); color: white; }

        /* --- SAÄ PANEL (NOT DEFTERÄ° & ENVANTER) --- */
        #notebook-panel { 
            flex: 1; 
            background: #e6dac3; 
            color: #3e2723; 
            padding: 20px; 
            border-radius: 4px; 
            font-family: 'Courier New', Courier, monospace; 
            border-left: 10px solid #5d4037; 
            display: flex;
            flex-direction: column;
            gap: 20px;
            box-shadow: 5px 5px 15px black;
            overflow-y: auto;
        }
        
        .notebook-section h3 { border-bottom: 2px solid #5d4037; margin-bottom: 10px; }
        .inventory-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; }
        .inv-item { background: rgba(0,0,0,0.1); padding: 10px; text-align: center; border-radius: 4px; font-size: 1.5em; cursor: help; }
        .note-entry { font-size: 0.9em; margin-bottom: 8px; border-bottom: 1px dashed #999; padding-bottom: 2px; }

        /* Animasyonlar */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
        @keyframes shake { 0% { transform: translate(1px, 1px); } 10% { transform: translate(-1px, -2px); } 20% { transform: translate(-3px, 0px); } 30% { transform: translate(3px, 2px); } 40% { transform: translate(1px, -1px); } 50% { transform: translate(-1px, 2px); } 60% { transform: translate(-3px, 1px); } 70% { transform: translate(3px, 1px); } 80% { transform: translate(-1px, -1px); } 90% { transform: translate(1px, 2px); } 100% { transform: translate(1px, -2px); } }
        
        .shaking { animation: shake 0.5s; }
        .red-alert { border: 2px solid red !important; box-shadow: 0 0 20px red; }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: #333; }
        
        #exit-btn {
        position: absolute;
        top: 10px;
        left: 10px;
        background: rgba(255, 68, 68, 0.2);
        color: #ff4444;
        border: 1px solid #ff4444;
        padding: 5px 15px;
        font-size: 0.8em;
        cursor: pointer;
        z-index: 1000;
        transition: 0.3s;
        text-decoration: none;
        display: flex;
        align-items: center;
        gap: 5px;
    }

    #exit-btn:hover {
        background: var(--danger);
        color: white;
        box-shadow: 0 0 10px var(--danger);
    }
    </style>
</head>
<body>
    <a href="index.html" id="exit-btn">
        <span>â¬…</span> Ã‡IKIÅ (VazgeÃ§)
    </a>
    <h2>ğŸ•µï¸â€â™‚ï¸ Dedektif Selim: MÃ¼ze VakasÄ± v2.0</h2>

    <div id="main-wrapper">
        <div id="game-container">
            <div id="stats-bar">
                <span class="stat-box" id="mental-stat" style="color:#3498db">ğŸ§  AkÄ±l: 100</span>
                <span class="stat-box" id="time-stat" style="color:#f1c40f">â³ Hamle: 0</span>
                <span class="stat-box" id="evidence-stat" style="color:#e74c3c">ğŸ” KanÄ±t: 0/4</span>
            </div>

            <div id="dialogue-box">
                <div class="msg msg-system">
                    MERKEZ: Selim, mÃ¼zede bÃ¼yÃ¼k bir hÄ±rsÄ±zlÄ±k oldu. Ä°Ã§eride 5 ÅŸÃ¼pheli var.<br>
                    Dikkatli ol, birbirleri hakkÄ±nda konuÅŸmalarÄ±nÄ± saÄŸla. Ä°sim vererek Ã§apraz sorgu yapabilirsin.<br>
                    <strong>Ã–rnek: "Leyla hakkÄ±nda ne dÃ¼ÅŸÃ¼nÃ¼yorsun?"</strong>
                </div>
            </div>

            <div class="suspect-list">
                </div>

            <div class="input-area">
                <input type="text" id="userInput" placeholder="Soru sor... (Ã–rn: Neredeydin?, Arda kim?, Neden yaptÄ±n?)" onkeypress="handleEnter(event)">
                <button class="btn-ask" onclick="askQuestion()">SOR</button>
            </div>

            <div style="margin-top: 10px; display:flex; gap:10px;">
                <button class="btn-action" onclick="searchRoom()">ğŸ” EtrafÄ± Ara (-10 AkÄ±l)</button>
                <button class="btn-action" onclick="analyzeClues()">ğŸ”¬ Laboratuvar Analizi (-20 AkÄ±l)</button>
            </div>
            
            <button id="arrestBtn" class="btn-action btn-arrest" onclick="toggleArrestMode()">ğŸš¨ TUTUKLAMA BAÅLAT ğŸš¨</button>
            
            <div id="arrest-overlay" style="display:none; text-align:center; padding:10px; background:#2a0a0a; margin-top:10px; border:1px solid red;">
                <h3 style="color:red; margin:5px;">âš ï¸ KÄ°MÄ° TUTUKLUYORSUN? âš ï¸</h3>
                <p style="font-size:0.8em; color:#aaa;">Dikkat: YanlÄ±ÅŸ tutuklama mesleÄŸini bitirir.</p>
                <div id="arrest-buttons" style="display:flex; gap:5px; justify-content:center; flex-wrap:wrap;"></div>
                <button class="btn-action" onclick="toggleArrestMode()" style="background:#444; width:50%; margin:auto; margin-top:5px;">Ä°PTAL</button>
            </div>
        </div>

        <div id="notebook-panel">
            <div class="notebook-section">
                <h3>ğŸ’ KanÄ±t Ã‡antasÄ±</h3>
                <div class="inventory-grid" id="inventory">
                    </div>
                <div id="inventory-text" style="font-size:0.8em; color:#5d4037; margin-top:5px; font-style:italic;"></div>
            </div>

            <div class="notebook-section">
                <h3>ğŸ“ Dedektif NotlarÄ±</h3>
                <div id="notes-container">
                    <div class="note-entry">- SoruÅŸturma baÅŸladÄ±.</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- OYUN KONFIGÃœRASYONU ---
        let mentalHealth = 100;
        let turnCount = 0;
        let evidenceFound = [];
        let currentSuspect = null;
        let gameActive = true;
        let guiltyPerson = ""; 
        
        // --- KARAKTER VERÄ°TABANI (Ã‡APRAZ SORGU SÄ°STEMÄ° EKLENDÄ°) ---
        const suspectsData = {
            "Leyla": {
                role: "KÃ¼ratÃ¶r",
                stress: 0,
                responses: {
                    default: "MÃ¼ze benim her ÅŸeyim, bu felaket beni mahvetti.",
                    alibi: "Ofisimde envanter kontrolÃ¼ yapÄ±yordum. Kameralar bozukmuÅŸ, ne tesadÃ¼f!",
                    motive: "BorÃ§larÄ±m olabilir ama hÄ±rsÄ±z deÄŸilim. Bu koleksiyon hayatÄ±m.",
                    opinions: { // Ã‡apraz Sorgu Verileri
                        "Kerem": "O bekÃ§iden hiÃ§ hoÅŸlanmÄ±yorum. SÃ¼rekli beni izliyor. Eski bir polismiÅŸ, neden atÄ±ldÄ± acaba?",
                        "Dalton": "Kibirli zenginin teki. ParasÄ±yla her ÅŸeyi satÄ±n alabileceÄŸini sanÄ±yor.",
                        "Sofia": "ZavallÄ± kadÄ±n, Ã§ok sessiz. Bazen varlÄ±ÄŸÄ±nÄ± bile unutuyorum.",
                        "Arda": "Ã‡ok yetenekli ama tehlikeli bir egosu var. Sahte eserler konusunda Ã§ok bilgili..."
                    }
                }
            },
            "Kerem": {
                role: "GÃ¼venlik",
                stress: 0,
                responses: {
                    default: "Ben sadece iÅŸimi yapÄ±yorum amirim. Sorun Ã§Ä±karmayÄ±n.",
                    alibi: "Arka bahÃ§ede devriyedeydim. Ã‡amurlu ayak izleri benim olabilir, hava yaÄŸmurluydu.",
                    motive: "Polislikten atÄ±ldÄ±m diye hÄ±rsÄ±z olacak deÄŸilim. Onurumu satmadÄ±m.",
                    opinions: {
                        "Leyla": "KadÄ±n Ã§ok gergin. SÃ¼rekli telefonla gizli gizli konuÅŸurken gÃ¶rÃ¼yorum.",
                        "Dalton": "O adamÄ± sevmem. Bize bÃ¶cek gibi bakÄ±yor. Bir dersi hak ediyor.",
                        "Sofia": "Sofia iyidir, zararsÄ±zdÄ±r. Onu karÄ±ÅŸtÄ±rmayÄ±n.",
                        "Arda": "LaboratuvarÄ±ndan garip kimyasal kokularÄ± geliyor. Ne piÅŸiriyor orada?"
                    }
                }
            },
            "Dalton": {
                role: "Koleksiyoner",
                stress: 0,
                responses: {
                    default: "Vaktim nakittir dedektif. Sorunuzu Ã§abuk sorun.",
                    alibi: "VIP salonda ÅŸampanyamÄ± yudumluyordum. Garson ÅŸahidimdir.",
                    motive: "Benim servetim bu mÃ¼zeyi on kere satÄ±n alÄ±r. Ã‡almama gerek yok.",
                    opinions: {
                        "Leyla": "Yeteneksiz bir yÃ¶netici. MÃ¼ze batmak Ã¼zere, o yÃ¼zden panik halinde.",
                        "Kerem": "Kaba saba bir adam. Bir hÄ±rsÄ±z tipi var onda.",
                        "Sofia": "TemizlikÃ§i mi? AdÄ±nÄ± bile bilmiyorum.",
                        "Arda": "O Ã§ocukta iÅŸ var. Sanattan anlÄ±yor. Belki ona iÅŸ teklif ederim."
                    }
                }
            },
            "Sofia": {
                role: "TemizlikÃ§i",
                stress: 0,
                responses: {
                    default: "B-ben bir ÅŸey gÃ¶rmedim efendim, yemin ederim.",
                    alibi: "HavalandÄ±rma boÅŸluklarÄ±nÄ± siliyordum. Biraz gÃ¼rÃ¼ltÃ¼ duydum ama korktum.",
                    motive: "Annem hasta... Ã‡ok paraya ihtiyacÄ±mÄ±z var ama haram yemem.",
                    opinions: {
                        "Leyla": "Bayan Leyla bana hep iyi davranÄ±r ama dÃ¼n gece aÄŸlÄ±yordu.",
                        "Kerem": "Kerem bey beni korur. O iyi biridir.",
                        "Dalton": "O beyefendiden korkuyorum. Bana baÄŸÄ±rÄ±p duruyor.",
                        "Arda": "Doktor bey bazen gece yarÄ±larÄ± gizlice mÃ¼zeye geliyor..."
                    }
                }
            },
            "Arda": {
                role: "RestoratÃ¶r",
                stress: 0,
                responses: {
                    default: "LÃ¼tfen dikkatli olun, buradaki toz bile tarihidir.",
                    alibi: "Laboratuvarda bir heykelin restorasyonuyla uÄŸraÅŸÄ±yordum. Ellerim hala alÃ§Ä±.",
                    motive: "Ben sanatÄ± korurum, Ã§almam. Bilim insanÄ±yÄ±m ben.",
                    opinions: {
                        "Leyla": "Sanattan anlamaz, sadece paradan anlar. Sigorta iÅŸleriyle Ã§ok ilgili.",
                        "Kerem": "Ã‡ok kaba. Sanat eserlerine dokunmamasÄ± gerektiÄŸini Ã¶ÄŸrenemedi.",
                        "Dalton": "Zevksiz bir zengin. Sadece gÃ¶steriÅŸ peÅŸinde.",
                        "Sofia": "Temizlik yaparken Ã§ok ses Ã§Ä±karÄ±yor, konsantrasyonumu bozuyor."
                    }
                }
            }
        };

        // Potansiyel kanÄ±tlar ve ikonlarÄ±
        const potentialEvidence = [
            { id: "eldiven", text: "YÄ±rtÄ±k bir deri eldiven parÃ§asÄ±.", icon: "ğŸ§¤", owner: "Dalton" },
            { id: "vida", text: "HavalandÄ±rmadan dÃ¼ÅŸmÃ¼ÅŸ bir tornavida.", icon: "ğŸ”§", owner: "Sofia" },
            { id: "toz", text: "KasanÄ±n Ã¼zerinde beyaz alÃ§Ä± tozu.", icon: "ğŸŒ«ï¸", owner: "Arda" },
            { id: "belge", text: "YÃ¼ksek miktarlÄ± bir borÃ§ senedi.", icon: "ğŸ“„", owner: "Leyla" },
            { id: "Ã§amur", text: "Kasa Ã¶nÃ¼nde taze Ã§amurlu bot izi.", icon: "ğŸ¥¾", owner: "Kerem" }
        ];

        // --- BAÅLANGIÃ‡ AYARLARI ---
        function initGame() {
            // Rastgele SuÃ§lu SeÃ§
            const keys = Object.keys(suspectsData);
            guiltyPerson = keys[Math.floor(Math.random() * keys.length)];
            console.log("Debug: SuÃ§lu " + guiltyPerson); // Hile iÃ§in konsola bakabilirsin :)

            renderSuspects();
            writeSystem("Dedektif, sahne senin. ÅÃ¼phelilere tÄ±kla ve sorular sor.");
        }

        function renderSuspects() {
            const list = document.querySelector('.suspect-list');
            const arrestDiv = document.getElementById('arrest-buttons');
            list.innerHTML = '';
            arrestDiv.innerHTML = '';

            Object.keys(suspectsData).forEach(name => {
                // ÅÃ¼pheli kartÄ± oluÅŸtur
                let div = document.createElement('div');
                div.className = 'suspect';
                div.id = 'card-' + name;
                div.innerHTML = `
                    <div style="font-size:1.5em">ğŸ‘¤</div>
                    <strong>${name}</strong><br>
                    <small>${suspectsData[name].role}</small>
                    <div class="suspect-stress-bar"><div class="stress-fill" id="stress-${name}"></div></div>
                `;
                div.onclick = () => selectSuspect(name);
                list.appendChild(div);

                // Tutuklama butonu oluÅŸtur
                let btn = document.createElement('button');
                btn.className = 'btn-ask'; // Stil Ã¶dÃ¼nÃ§ al
                btn.style.background = '#330000';
                btn.innerText = name;
                btn.onclick = () => finalizeArrest(name);
                arrestDiv.appendChild(btn);
            });
        }

        function selectSuspect(name) {
            if (!gameActive) return;
            currentSuspect = name;
            
            // GÃ¶rsel gÃ¼ncelleme
            document.querySelectorAll('.suspect').forEach(el => el.classList.remove('active'));
            document.getElementById('card-' + name).classList.add('active');
            
            writeSystem(`${name} sana bakÄ±yor. Ne soracaksÄ±n?`);
        }

        // --- SORGULAMA MOTORU (AI PARSER) ---
        function askQuestion() {
            if (!gameActive) return;
            if (!currentSuspect) {
                alert("Ã–nce bir ÅŸÃ¼pheli seÃ§melisin!");
                return;
            }

            const inputEl = document.getElementById('userInput');
            const text = inputEl.value.trim().toLowerCase();
            if (!text) return;

            writeDialogue("Sen", inputEl.value, "msg-hero");
            inputEl.value = "";
            
            turnCount++;
            document.getElementById('time-stat').innerText = "â³ Hamle: " + turnCount;

            processAnswer(currentSuspect, text);
        }

        function processAnswer(suspectName, question) {
            const person = suspectsData[suspectName];
            let response = "";
            let stressIncrease = 0;

            // 1. Ã‡APRAZ SORGU KONTROLÃœ (En Ã¶nemli yenilik)
            // Sorulan cÃ¼mlenin iÃ§inde baÅŸka bir ÅŸÃ¼phelinin adÄ± geÃ§iyor mu?
            let mentionedSuspect = Object.keys(suspectsData).find(otherName => 
                question.includes(otherName.toLowerCase())
            );

            // EÄŸer kendi adÄ±nÄ± sorarsa
            if (mentionedSuspect === suspectName) {
                response = "Benim hakkÄ±mda ne mi dÃ¼ÅŸÃ¼nÃ¼yorum? Ben masumum!";
                stressIncrease = 5;
            }
            // BaÅŸkasÄ± hakkÄ±nda sorarsa
            else if (mentionedSuspect) {
                response = `[${mentionedSuspect} HakkÄ±nda]: ` + person.responses.opinions[mentionedSuspect];
            }
            // 2. KELÄ°ME ANAHTARLARI
            else if (question.includes("nerde") || question.includes("nerede") || question.includes("konum") || question.includes("zaman")) {
                // EÄŸer suÃ§luysa yalan sÃ¶yler (basit mantÄ±k)
                if (suspectName === guiltyPerson && Math.random() > 0.5) {
                    response = "Åey... Tuvaletteydim. HayÄ±r, bekle, telefonla konuÅŸuyordum.";
                    stressIncrease = 15; // Yalan sÃ¶ylerken gerilir
                } else {
                    response = person.responses.alibi;
                }
            }
            else if (question.includes("neden") || question.includes("sebep") || question.includes("para") || question.includes("borÃ§")) {
                response = person.responses.motive;
                stressIncrease = 5;
            }
            else if (question.includes("polis") || question.includes("hapis") || question.includes("itiraf")) {
                response = "Beni korkutamazsÄ±n dedektif!";
                stressIncrease = 10;
            }
            else {
                response = person.responses.default;
                response += " (AnlamadÄ±m, daha aÃ§Ä±k konuÅŸ.)";
            }

            // Stres YÃ¶netimi
            person.stress += stressIncrease;
            updateStressVisual(suspectName, person.stress);

            // Ã‡ok stresliyse konuÅŸmaz
            if (person.stress >= 100) {
                response = "BUNALDIM! ARTIK TEK KELÄ°ME ETMEYECEÄÄ°M!";
                response = response.toUpperCase();
            }

            // Gecikmeli cevap
            setTimeout(() => {
                writeDialogue(suspectName, response, "msg-suspect");
                // AkÄ±l saÄŸlÄ±ÄŸÄ± cezasÄ± (her soruda az da olsa yorulursun)
                updateMental(-2);
            }, 600);
        }

        function handleEnter(e) {
            if (e.key === 'Enter') askQuestion();
        }

        // --- AKSÄ°YONLAR ---
        function searchRoom() {
            if(!gameActive) return;
            if (mentalHealth < 10) {
                writeSystem("Ã‡ok yorgunsun, arama yapamazsÄ±n.");
                return;
            }

            updateMental(-10);
            writeSystem("EtrafÄ± didik didik arÄ±yorsun...");

            setTimeout(() => {
                // Rastgele bir kanÄ±t bulma ÅŸansÄ±
                // KanÄ±t sistemi: SuÃ§luya ait kanÄ±tÄ± bulma ÅŸansÄ±n daha yÃ¼ksek olsun
                let foundItem = null;
                
                // %40 ÅŸansla suÃ§lunun kanÄ±tÄ±, %30 rastgele, %30 boÅŸ
                const rand = Math.random();
                if (rand < 0.4) {
                    // SuÃ§lunun kanÄ±tÄ±nÄ± bul
                    foundItem = potentialEvidence.find(e => e.owner === guiltyPerson);
                } else if (rand < 0.7) {
                    // Rastgele bir kanÄ±t bul
                    foundItem = potentialEvidence[Math.floor(Math.random() * potentialEvidence.length)];
                }

                if (foundItem && !evidenceFound.includes(foundItem.id)) {
                    evidenceFound.push(foundItem.id);
                    addInventoryItem(foundItem);
                    writeSystem(`BÄ°R ÅEY BULDUN: ${foundItem.text}`);
                    document.getElementById('evidence-stat').innerText = `ğŸ” KanÄ±t: ${evidenceFound.length}/4`;
                } else {
                    writeSystem("HiÃ§bir ÅŸey bulamadÄ±n. Sadece toz.");
                }
            }, 1000);
        }

        function analyzeClues() {
            if (evidenceFound.length === 0) {
                alert("Analiz edilecek kanÄ±tÄ±n yok!");
                return;
            }
            updateMental(-20);
            writeSystem("Laboratuvar sonuÃ§larÄ± bekleniyor...");
            
            setTimeout(() => {
                // Basit bir ipucu ver
                const clues = [
                    "Bulunan parmak izleri " + guiltyPerson + " ile kÄ±smen uyuÅŸuyor.",
                    "SuÃ§ saati sÄ±rasÄ±nda " + guiltyPerson + " gÃ¼venlik kameralarÄ±nda gÃ¶rÃ¼nmÃ¼yor.",
                    "Olay yerinde bulunan DNA Ã¶rneÄŸi belirsiz ama ÅŸÃ¼pheli."
                ];
                writeNote(clues[Math.floor(Math.random() * clues.length)]);
            }, 1500);
        }

        // --- UI GÃœNCELLEMELERÄ° ---
        function writeDialogue(who, text, cssClass) {
            const box = document.getElementById('dialogue-box');
            box.innerHTML += `<div class="msg ${cssClass}"><strong>${who}:</strong> ${text}</div>`;
            box.scrollTop = box.scrollHeight;
        }

        function writeSystem(text) {
            const box = document.getElementById('dialogue-box');
            box.innerHTML += `<div class="msg msg-system">${text}</div>`;
            box.scrollTop = box.scrollHeight;
        }

        function writeNote(text) {
            const container = document.getElementById('notes-container');
            container.innerHTML += `<div class="note-entry">â¤ ${text}</div>`;
            // Not defterine scroll
            const panel = document.getElementById('notebook-panel');
            panel.scrollTop = panel.scrollHeight;
        }

        function addInventoryItem(item) {
            const grid = document.getElementById('inventory');
            const div = document.createElement('div');
            div.className = 'inv-item';
            div.innerText = item.icon;
            div.title = item.text;
            div.onclick = () => {
                document.getElementById('inventory-text').innerText = item.text + " (" + item.owner + "?)";
            };
            grid.appendChild(div);
            
            // KanÄ±tÄ± nota da ekle
            writeNote(`KANIT: ${item.text}`);
        }

        function updateMental(amount) {
            mentalHealth += amount;
            if (mentalHealth > 100) mentalHealth = 100;
            const el = document.getElementById('mental-stat');
            el.innerText = `ğŸ§  AkÄ±l: ${mentalHealth}`;
            
            // GÃ¶rsel efekt
            document.body.classList.add('shaking');
            setTimeout(() => document.body.classList.remove('shaking'), 500);

            if (mentalHealth <= 0) {
                gameOver("AkÄ±l saÄŸlÄ±ÄŸÄ±nÄ± yitirdin. ÅÃ¼pheliler seni manipÃ¼le etti ve dava kapandÄ±.");
            }
        }

        function updateStressVisual(name, value) {
            const bar = document.getElementById(`stress-${name}`);
            if (bar) {
                bar.style.width = value + "%";
            }
        }

        // --- TUTUKLAMA VE SONUÃ‡ ---
        function toggleArrestMode() {
            const overlay = document.getElementById('arrest-overlay');
            if (overlay.style.display === 'none') {
                overlay.style.display = 'block';
                document.body.classList.add('red-alert');
            } else {
                overlay.style.display = 'none';
                document.body.classList.remove('red-alert');
            }
        }

        function finalizeArrest(name) {
            gameActive = false;
            document.getElementById('arrest-overlay').style.display = 'none';
            document.body.classList.remove('red-alert');

            let message = "";
            let color = "";

            if (name === guiltyPerson) {
                color = "#00ff9d";
                message = `
                    <h1 style="color:${color}">BAÅARILI!</h1>
                    <p>MÃ¼cevher hÄ±rsÄ±zÄ± <strong>${name}</strong> yakalandÄ±.</p>
                    <p>Bulunan kanÄ±tlar ve Ã§apraz sorgu taktiklerin iÅŸe yaradÄ±.</p>
                    <p>Terfi aldÄ±n Dedektif!</p>
                `;
            } else {
                color = "#ff4444";
                message = `
                    <h1 style="color:${color}">YANLIÅ KARAR!</h1>
                    <p>Masum olan <strong>${name}</strong> tutuklandÄ±.</p>
                    <p>GerÃ§ek suÃ§lu <strong>${guiltyPerson}</strong> ise bu sÄ±rada kaÃ§tÄ±.</p>
                    <p>Rozetin ve silahÄ±n masaya Dedektif. Kovuldun.</p>
                `;
            }

            document.getElementById('game-container').innerHTML = `
                <div style="text-align:center; padding:50px;">
                    ${message}
                    <button class="btn-ask" onclick="location.reload()" style="margin-top:20px;">YENÄ° OYUN</button>
                </div>
            `;
        }

        function gameOver(reason) {
            gameActive = false;
            document.getElementById('game-container').innerHTML = `
                <div style="text-align:center; padding:50px;">
                    <h1 style="color:gray">OYUN BÄ°TTÄ°</h1>
                    <p>${reason}</p>
                    <p>GerÃ§ek SuÃ§lu: ${guiltyPerson}</p>
                    <button class="btn-ask" onclick="location.reload()">TEKRAR DENE</button>
                </div>
            `;
        }

        // BaÅŸlat
        initGame();

    </script>
</body>
</html>